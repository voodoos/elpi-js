import{S as e,E as t,a as r,b as n}from"./vendor.c9c62fb2.js";function s(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))}function o(e,t,r){console.log(e,t,r);let n=document.createElement("div");n.className="text-"+(e=>{switch(e){case"info":return"info";case"warning":return"warning";case"error":return"danger";default:return"body"}})(e),n.innerHTML="Log ("+e+") : [ "+t+"] : "+r,document.getElementById("console").prepend(n)}const i=document.getElementById("table-body");var a=0;const c=document.getElementById("editor"),l=document.getElementById("build"),u=document.getElementById("restart"),d=document.getElementById("query"),m=document.getElementById("query_text");let p=["module","sig","import","shorten","accum_sig","use_sig","local","pred","prop","mode","macro","rule","namespace","constraint","localkind","useonly","exportdef","kind","typeabbrev","type","external","closed","end","accumulate","infixl","infixr","infix","prefix","prefixr","postfix","postfixl"];const x=e.define({startState:()=>({count:0}),token:(e,t)=>e.eatSpace()?null:e.match(/^%.*/)?"lineComment":e.match(/^"[^"]*"/)?"string":e.match(/^\d+/)?"number":e.match(/^\w+/)?p.indexOf(e.current())>=0?"keyword":"variableName":e.match(/^[().{}\->]/)?"punctuation":(e.eol()||e.next(),null),indent:e=>e.count});let h=new t({state:r.create({extensions:[n,x],doc:"type mappred (A -> B -> prop) -> list A -> list B -> prop.\n\nmappred P nil nil.\nmappred P (X::L) (Y::K) :- P X Y, mappred P L K.\n\nkind name             type.\ntype bob, sue, ned    name.\ntype age              name -> int -> prop.\ntype male, female     name -> prop.\n\nage  bob 23 & age sue 24 & age  ned 23.\nmale bob    & female sue & male ned.\n"}),parent:c});var f;window.onresize=function(){clearTimeout(f),f=setTimeout((()=>h.requestMeasure()),100)};const g=new class{constructor(e,t,r){this.worker=null,this.logger=e,this.answer=t,this.workerScript=r,this.resolves=[],this.rejects=[];var n=this;this.onmessage=function(r){console.log("info","Elpi","Message received from worker:",r.data);var s=r.data;switch(s.type){case"answer":t(s.values);break;case"log":e(s.lvl,s.prefix,s.text);break;case"resolve":n.resolves[s.uuid](s.value),delete n.resolves[s.uuid],delete n.rejects[s.uuid];break;case"reject":n.rejects[s.uuid](new Error(s.value)),delete n.resolves[s.uuid],delete n.rejects[s.uuid]}},this.start=this.startElpi()}startElpi(){this.worker=new Worker(this.workerScript),this.worker.onmessage=this.onmessage;var e=this;return new Promise((function(t,r){e.resolves.start=t,e.rejects.start=r}))}registerPromise(e,t){var r=this;return new Promise((function(n,s){r.resolves[e]=n,r.rejects[e]=s,r.worker.postMessage(t)}))}compile(e,t=!0){const r=s(),n={type:"compile",files:e,check:t,uuid:r};return this.registerPromise(r,n)}queryAll(e){const t=s(),r={type:"queryAll",code:e,uuid:t};return this.registerPromise(t,r)}restart(){this.worker.terminate();var e=this;return Object.keys(this.rejects).forEach((function(t){e.rejects[t](new Error("Elpi restarted"))})),this.resolves=[],this.rejects=[],this.start=this.startElpi()}}(o,(function(e){const t=e.length;if(e.length>0){const n=document.createElement("tr"),s=document.createElement("th");s.setAttribute("rowspan",t),s.setAttribute("scope","row"),s.textContent=++a,n.append(s);var r=[];e.forEach((e=>{const t=document.createElement("td");t.textContent=e.arg;const s=document.createElement("td");if(s.textContent=e.ass,0===r.length)n.append(t,s),r.push(n);else{const e=document.createElement("tr");e.append(t,s),r.push(e)}})),i.append(...r)}}),"./elpi-worker.bc.js"),b=e=>{o("info","demo","Elpi started"),l.removeAttribute("disabled"),u.removeAttribute("disabled")};g.start.then(b),l.onclick=e=>{d.setAttribute("disabled","true"),l.setAttribute("disabled","true"),g.compile([{name:"demo.elpi",content:h.state.doc.toJSON().join("\n")}],!0).then((e=>{const t=e.filter((e=>!e.startsWith("std.")));console.log("info","Preds",JSON.stringify(t,null,4)),d.removeAttribute("disabled")})).catch((e=>{o("error","demo",e)})).finally((e=>l.removeAttribute("disabled")))},d.onclick=e=>{i.textContent="",g.queryAll(m.value).then((e=>{console.log("info","demo",JSON.stringify(e,null,4))})).catch((e=>{o("error","demo",e)}))},u.onclick=e=>{l.setAttribute("disabled","true"),u.setAttribute("disabled","true"),d.setAttribute("disabled","true"),g.restart().then(b)};
